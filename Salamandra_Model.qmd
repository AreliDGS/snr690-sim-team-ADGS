---
title: "Salamandra Model - AreliDGS"
format: html
editor: visual
---

# **Activity 1: Salamander Survival (Partner A) — Station 1 from Week 3**

#### - What is the research question? 

Is canopy cover affects salamander survival in forest fragments

#### - What is the experimental design? 

-   12 forest fragments

-   20 salamanders per fragment (240 total salamanders)

-   Canopy cover ranges from 40% to 90%. Canopy cover was measured as a percentage for each fragment.

#### -  What is the response variable? 

Survival rate (0 = dead, 1 = alive)

#### - What type of variable is it? 

Binomial (dicotómica)

#### - Why does this structure matter for the analysis?

We have to use a logistic relationship

\#

## Step by step

### 1. Simulate the data set 

-   Define the experimental structure

-   Create fragment-level data

-   Create salamander-level data

-   Merge to get canopy cover for each salamander

```{r}
library(tidyverse)
library(lme4)  # for mixed models later

set.seed(42)

```

```{r}
# Define the experimental structure
n_fragments <- 12 # Vector of number of fragments
n_salamanders_per_fragment <- 20 # Vector of number of sampled salamanders per fragments
n_total <- n_fragments * n_salamanders_per_fragment # Define the experimental units


# Create fragment-level data
fragment_data <- data.frame(
  fragment_id = 1:n_fragments, #create the column beggining with number 1 until the number definend in the object of n_fragment
  canopy_cover = runif(n_fragments, min = 40, max = 90) #create a random numbers with a normal distribution between the range of 40-90
)

# Create salamander-level data (each salamander belongs to a fragment)
salamander_data <- data.frame(
  salamander_id = 1:n_total,# create a column from 1 to the number defined in the object of n_total
  fragment_id = rep(1:n_fragments, each = n_salamanders_per_fragment) # repeat from 1 to the number of n_fragments for each fragments 
)

# Merge to get canopy cover for each salamander
salamander_data <- salamander_data %>%
  left_join(fragment_data, by = "fragment_id")
```

### 2. Define the coefficients of my model

-    Create the objects with the values of the true intercept and true canopy effect

-   Simulate survival using logistic regression formula

-   Check the results

```{r}
# Define the truth
true_intercept <- -3.5  # Define the intercepts of the model        
true_canopy_effect <- 0.09 # Define the value of the canopy effect   


# Simulate survival using logistic regression formula
salamander_data <- salamander_data %>%
  mutate(
    log_odds = true_intercept + true_canopy_effect * canopy_cover,
    prob_survival = 1 / (1 + exp(-log_odds)),
    survived = rbinom(n_total, size = 1, prob = prob_survival)
  )

# Look at the data
head(salamander_data)
summary(salamander_data) # Get the coefficientes of the model 

```

### 3. Visualization of the model 

-   Table: proportion surviving in each fragment

```{r}

# Visualize: proportion surviving in each fragment
fragment_summary <- salamander_data %>%
  group_by(fragment_id, canopy_cover) %>%
  summarise(
    n_survived = sum(survived),
    n_total = n(),
    prop_survived = n_survived / n_total,
    .groups = "drop"
  )

plot1 <- ggplot(fragment_summary, aes(x = canopy_cover, y = prop_survived)) +
  geom_point(size = 4, alpha = 0.7) +
  labs(
    title = "Simulated: Canopy Cover vs. Salamander Survival",
    subtitle = "Each point = one forest fragment (20 salamanders each)",
    x = "Canopy Cover (%)",
    y = "Proportion Survived"
  ) +
  ylim(0, 1) +
  theme_minimal(base_size = 14)

fragment_summary
plot1
```
